<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kids Try-On (Baju + Celana)</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    #video { display: none; }
    canvas { border: 1px solid #ccc; max-width: 100%; }
    .controls { margin: 10px; }
    img.overlay { position: absolute; top: 0; left: 0; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/pose.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
</head>
<body>
  <h2>ðŸ‘•ðŸ‘– Kids Try-On (Baju + Celana)</h2>

  <div class="controls">
    <label>Pilih Baju:</label>
    <select id="bajuSelect">
      <option value="baju1.png">Baju 1</option>
      <option value="baju2.png">Baju 2</option>
      <option value="baju3.png">Baju 3</option>
    </select>
  </div>

  <div class="controls">
    <label>Pilih Celana:</label>
    <select id="celanaSelect">
      <option value="celana1.png">Celana 1</option>
      <option value="celana2.png">Celana 2</option>
      <option value="celana3.png">Celana 3</option>
    </select>
  </div>

  <video id="video" playsinline></video>
  <canvas id="output"></canvas>

  <script>
    const video = document.getElementById("video");
    const canvas = document.getElementById("output");
    const ctx = canvas.getContext("2d");

    const bajuSelect = document.getElementById("bajuSelect");
    const celanaSelect = document.getElementById("celanaSelect");

    let bajuImg = new Image();
    let celanaImg = new Image();
    bajuImg.src = bajuSelect.value;
    celanaImg.src = celanaSelect.value;

    bajuSelect.addEventListener("change", () => { bajuImg.src = bajuSelect.value; });
    celanaSelect.addEventListener("change", () => { celanaImg.src = celanaSelect.value; });

    // MediaPipe Pose setup
    const pose = new Pose.Pose({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/${file}`
    });
    pose.setOptions({
      modelComplexity: 1,
      smoothLandmarks: true,
      enableSegmentation: true,
      minDetectionConfidence: 0.5,
      minTrackingConfidence: 0.5
    });

    pose.onResults(onResults);

    const camera = new Camera(video, {
      onFrame: async () => { await pose.send({image: video}); },
      width: 640,
      height: 480
    });
    camera.start();

    function onResults(results) {
      canvas.width = results.image.width;
      canvas.height = results.image.height;

      // Gambar video asli
      ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);

      if (results.poseLandmarks) {
        const lm = results.poseLandmarks;

        // Hitung bounding box untuk torso (baju)
        const leftShoulder = lm[11];
        const rightShoulder = lm[12];
        const leftHip = lm[23];
        const rightHip = lm[24];

        const torsoX = (leftShoulder.x + rightShoulder.x) / 2 * canvas.width;
        const torsoY = (leftShoulder.y + rightShoulder.y) / 2 * canvas.height;
        const torsoWidth = Math.abs(rightShoulder.x - leftShoulder.x) * canvas.width * 2;
        const torsoHeight = Math.abs(leftHip.y - torsoY/canvas.height) * canvas.height * 1.3;

        ctx.drawImage(bajuImg, torsoX - torsoWidth/2, torsoY, torsoWidth, torsoHeight);

        // Hitung bounding box untuk celana
        const midHipX = (leftHip.x + rightHip.x) / 2 * canvas.width;
        const hipY = ((leftHip.y + rightHip.y) / 2) * canvas.height;
        const leftKnee = lm[25];
        const rightKnee = lm[26];
        const kneeY = ((leftKnee.y + rightKnee.y) / 2) * canvas.height;

        const celanaWidth = Math.abs(rightHip.x - leftHip.x) * canvas.width * 2;
        const celanaHeight = (kneeY - hipY) * 1.3;

        ctx.drawImage(celanaImg, midHipX - celanaWidth/2, hipY, celanaWidth, celanaHeight);
      }
    }
  </script>
</body>
</html>
