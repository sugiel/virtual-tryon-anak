<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Virtual Try-On Anak</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#f9f9f9; }
    h1 { text-align: center; }
    .container { display: flex; gap: 20px; justify-content: center; }
    .box { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 0 8px rgba(0,0,0,0.1); width: 320px; }
    .preview img { max-width: 100%; border-radius: 10px; margin-top: 10px; }
    .clothes { display: flex; gap: 10px; margin: 10px 0; flex-wrap: wrap; }
    .clothes img { width: 80px; cursor: pointer; border:2px solid transparent; border-radius:8px; }
    .clothes img.selected { border-color: blue; }
    button { margin-top: 10px; padding: 10px 15px; border:none; border-radius:8px; cursor:pointer; }
    #generateBtn { background:#007bff; color:white; }
    #downloadBtn { background:#28a745; color:white; }
    #shopeeBtn { background:#ff2d2d; color:white; width:100%; }
    .tips { font-size:12px; color:#666; margin-top:10px; }
  </style>
</head>
<body>
  <h1>Virtual Try-On Anak</h1>
  <div class="container">
    <!-- Kiri -->
    <div class="box">
      <input type="file" id="uploadInput" accept="image/*">
      <div class="preview" id="uploadPreview">Upload foto anak</div>

      <h3>Baju:</h3>
      <div class="clothes" id="bajuOptions">
        <img src="baju1.png" data-id="1">
        <img src="baju2.png" data-id="2">
        <img src="baju3.png" data-id="3">
      </div>

      <h3>Celana:</h3>
      <div class="clothes" id="celanaOptions">
        <img src="celana1.png" data-id="1">
        <img src="celana2.png" data-id="2">
        <img src="celana3.png" data-id="3">
      </div>

      <button id="generateBtn">Generate AI Try-On</button>
      <button id="downloadBtn" disabled>Download</button>
      <div class="tips">Tips: gunakan foto full-body, pencahayaan terang â†’ hasil lebih rapi.</div>
    </div>

    <!-- Kanan -->
    <div class="box">
      <div id="resultBox">Hasil akan muncul di sini</div>
      <button id="shopeeBtn" onclick="window.open('https://shopee.co.id/ovikids', '_blank')">Beli di Shopee</button>
    </div>
  </div>

  <script>
    const uploadInput = document.getElementById('uploadInput');
    const uploadPreview = document.getElementById('uploadPreview');
    const generateBtn = document.getElementById('generateBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const resultBox = document.getElementById('resultBox');

    let uploadedFile = null;
    let selectedBaju = null, selectedCelana = null;

    uploadInput.onchange = e=>{
      const file = e.target.files[0];
      if(file){
        uploadedFile = file;
        const img = document.createElement('img');
        img.src = URL.createObjectURL(file);
        uploadPreview.innerHTML = '';
        uploadPreview.appendChild(img);
      }
    };

    document.querySelectorAll('#bajuOptions img').forEach(img=>{
      img.onclick = ()=>{
        document.querySelectorAll('#bajuOptions img').forEach(i=>i.classList.remove('selected'));
        img.classList.add('selected');
        selectedBaju = img.dataset.id;
      };
    });
    document.querySelectorAll('#celanaOptions img').forEach(img=>{
      img.onclick = ()=>{
        document.querySelectorAll('#celanaOptions img').forEach(i=>i.classList.remove('selected'));
        img.classList.add('selected');
        selectedCelana = img.dataset.id;
      };
    });

    generateBtn.onclick = ()=>{
      if(!uploadedFile){ alert('Upload foto dulu'); return; }
      if(!selectedBaju || !selectedCelana){ alert('Pilih baju dan celana dulu'); return; }

      generateBtn.disabled = true;
      generateBtn.innerText = 'Processing...';

      const bajuMap = {1:'baju merah waffle sleeveless',2:'baju biru polos',3:'baju kuning ceria'};
      const celanaMap = {1:'celana pendek putih',2:'celana jeans',3:'celana hitam polos'};

      const prompt = `Ganti pakaian anak di foto ini dengan ${bajuMap[selectedBaju]} dan ${celanaMap[selectedCelana]}. Full-body, pose sama, background sama, studio quality.`;

      const reader = new FileReader();
      reader.onload = async ()=>{
        const base64Img = reader.result;

        try {
          const response = await fetch("https://virtual-tryon-anak.vercel.app/api/generate", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({ prompt, image: base64Img })
          });

          const data = await response.json();

          if(data.url){
            resultBox.innerHTML = '';
            const resultImg = new Image();
            resultImg.src = data.url;
            resultBox.appendChild(resultImg);

            downloadBtn.disabled = false;
            downloadBtn.onclick = ()=>{
              const a = document.createElement('a');
              a.href = data.url;
              a.download = 'tryon_ai.png';
              a.click();
            };
          } else {
            alert('Gagal generate AI. Coba lagi.');
          }
        } catch(err){
          console.error(err);
          alert('Error koneksi API.');
        }

        generateBtn.disabled = false;
        generateBtn.innerText = 'Generate AI Try-On';
      };
      reader.readAsDataURL(uploadedFile);
    };
  </script>
</body>
</html>
